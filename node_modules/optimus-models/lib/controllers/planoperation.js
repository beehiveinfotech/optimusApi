'use strict'
module.exports.planoperation=(req,res,next)=>{
    let options = req.headers.options
    ,db = options.db
    ,p_planname = req.body.planname
    ,p_currencycode = req.body.currencycode
    ,p_contract = req.body.contract
    ,p_minimumunit = req.body.minimumunit
    ,p_price = req.body.price
    ,p_isstockavailable = req.body.isstockavailable
    ,p_maintenanceper = req.body.maintenanceper
    ,p_discount = req.body.discount
    ,p_payout = req.body.payout
    ,p_projectedpayout = req.body.projectedpayout
    ,p_comment = req.body.comment
    ,p_isactive = req.body.isactive
    ,p_operationtype = req.body.operationtype
    ,p_planid  = req.body.planid 

    
    // ,emailconfig = require('../../../../config/emailsend.js')
   ,response = {
    'success':false,
    'message':''     
   
   }
   console.log('The body is',req.body)

    return new Promise((resolve,reject)=>{
    db.query('select get_plan_opration($1,$2,$3,$4::int,$5::int,$6,$7::int,$8::int,$9::int,$10,$11,$12,$13,$14)',[
                     p_planname,p_currencycode,p_contract,p_minimumunit,p_price,
                     p_isstockavailable,p_maintenanceper,p_discount,p_payout,p_projectedpayout
                     ,p_comment,p_isactive,p_operationtype,p_planid], (err, result) => {
         if(err){
            console.log('The Error',err)
            response['success']= 'false'
            response['message'] = 'Error in Operation'
            return reject(response)

         }else{
            console.log('the row value',result.rows[0].get_plan_opration)
            response['success']= true
            response['message'] = 'Data Fetched'
            response['data'] = result.rows[0].get_plan_opration
            return resolve(response)

         }

    })
   }).then(response=>{
    res.status(200).json(response)
   }).catch(error=>{
    res.status(200).json(response)
   })

}