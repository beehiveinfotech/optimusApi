'use strict'
module.exports.purchaseoperation=(req,res,next)=>{
    let options = req.headers.options
    ,db = options.db
    ,p_planid = req.body.planid
    ,p_unit = req.body.unit
    ,p_price = req.body.price
    ,p_discount = req.body.discount
    ,p_maintenancecharge = req.body.maintenancecharge
    ,p_gatewaycharge = req.body.gatewaycharge
    ,p_totalamount = req.body.totalamount
    ,p_operationtype = req.body.operationtype    
    ,p_emailaddress = req.body.emailaddress
   
    // p_planid integer, 1
	// p_unit numeric, 2
	// p_price numeric, 3
	// p_discount numeric, 4
	// p_maintenancecharge numeric, 5
	// p_gatewaycharge numeric, 6
	// p_totalamount numeric, 7
	// p_operationtype character varying, 8
	// p_emailaddress character varying 9
   
    // ,emailconfig = require('../../../../config/emailsend.js')
   ,response = {
    'success':false,
    'message':''     
   
   }
   console.log('The body is',req.body)

    return new Promise((resolve,reject)=>{
    db.query('select get_purchase_operation($1::int,$2::int,$3::float,$4::float,$5::float,$6::float,$7::float,$8,$9)',[
        p_planid,p_unit,p_price,p_discount,p_maintenancecharge,
        p_gatewaycharge,p_totalamount,p_operationtype,p_emailaddress], (err, result) => {
         if(err){
            console.log('The Error',err)
            response['success']= 'false'
            response['message'] = 'Error in Operation'
            return reject(response)

         }else{
            console.log('the row value',result.rows[0].get_purchase_operation)
            response['success']= true
            response['message'] = 'Data Fetched'
            response['data'] = result.rows[0].get_purchase_operation
            return resolve(response)

         }

    })
   }).then(response=>{
    res.status(200).json(response)
   }).catch(error=>{
    res.status(200).json(response)
   })

}