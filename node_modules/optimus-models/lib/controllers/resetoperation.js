'use strict'
module.exports.resetoperation=(req,res,next)=>{
    let options = req.headers.options
    ,db = options.db
    ,p_emailaddress = req.body.emailaddress
    ,p_otp = req.body.otp
    ,p_newpwd = req.body.newpassword
    ,p_operationtype = req.body.operationtype
    
    
    ,emailconfig = require('../../../../config/emailsend.js')
   ,response = {
    'success':false,
    'message':''     
   
   }
   console.log('The body is',req.body)

    return new Promise((resolve,reject)=>{
    db.query('select get_forget_operations($1,$2,$3,$4)',[p_emailaddress,p_otp,p_newpwd,p_operationtype], (err, result) => {
         if(err){
            console.log('The Error',err)
            response['success']= false
            response['message'] = 'Error in Operation'
            return reject(response)

         }else{

            console.log('the Result value',result.rows[0].get_forget_operations)
    
            if(p_operationtype === 'ResetOTPSent'){              
                    
                    if(result.rows[0].get_forget_operations[0].success){
                        console.log('The Email end ')
                        emailconfig(p_emailaddress, result.rows[0].get_forget_operations[0].emailsubject, result.rows[0].get_forget_operations[0].emailbody)
                   }
            }
            response['success']= result.rows[0].get_forget_operations[0].success
            response['message'] = result.rows[0].get_forget_operations[0].msg
            response['data'] = result.rows[0].get_forget_operations[0]
           
            return resolve(response)

         }

    })
   }).then(response=>{
    res.status(200).json(response)
   }).catch(error=>{
    res.status(200).json(response)
   })

}